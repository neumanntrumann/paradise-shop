
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PARADISE SHOP - Home</title>
  <style>
    /* The exact same styles you provided go here */
  </style>
</head>
<body>

  <!-- Floating emojis -->
  <div class="floating" style="top: 100px; left: 20px;">üå∫</div>
  <div class="floating" style="top: 250px; right: 30px;">üåä</div>
  <div class="floating" style="top: 400px; left: 50%;">üå¥</div>

  <!-- Hamburger menu toggle -->
  <div id="menuToggle">
    <span></span>
    <span></span>
    <span></span>
  </div>

  <!-- Side navigation menu -->
  <nav id="sideMenu">
    <a href="/index">Home</a>
    <a href="/balance">Balance</a>
    <a href="/marketplace">Market</a>
    <a href="/cart">Cart</a>
    <a href="/orders">Orders</a>
    <a href="/more">More</a>
    <a href="/logout">Logout</a>
  </nav>

  <!-- Profile dropdown -->
  <div id="profileDropdownContainer">
    <div id="profileIcon">üë§</div>
    <div id="profileDropdown">
      <div id="profileInfo">Loading...</div>
      <a href="/balance">Load Funds</a>
      <a href="/index">Shop</a>
      <a href="/cart">Cart</a>
      <a href="/orders">Orders</a>
      <a href="/logout">Logout</a>
    </div>
  </div>

  <h1 class="fade-slide">üå¥ <span class="wave-emoji">WELCOME TO PARADISE SHOP</span> üå¥</h1>

  <div class="fade-slide" style="max-width: 800px; margin: 30px auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); line-height: 1.6;">
    <h2 style="text-align:center;">üõçÔ∏è Available Products</h2>
    {% for product in products %}
      <div style="margin: 20px 0; padding: 15px; background: #f9f9f9; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
        <strong>{{ product.name }}</strong><br>
        ${{ "%.2f"|format(product.price) }}
        <form action="/checkout/{{ product.id }}" method="get" style="margin-top: 10px;">
          <button type="submit">Buy Now</button>
        </form>
      </div>
    {% endfor %}
  </div>

  <script>
    const profileIcon = document.getElementById('profileIcon');
    const profileDropdown = document.getElementById('profileDropdown');
    const profileInfoDiv = document.getElementById('profileInfo');
    const menuToggle = document.getElementById('menuToggle');
    const sideMenu = document.getElementById('sideMenu');

    function toggleMenu() {
      sideMenu.classList.toggle('active');
    }
    menuToggle.addEventListener('click', toggleMenu);
    window.addEventListener('click', (e) => {
      if (!sideMenu.contains(e.target) && !menuToggle.contains(e.target)) {
        sideMenu.classList.remove('active');
      }
    });

    function toggleProfileDropdown() {
      const isActive = profileDropdown.classList.toggle('active');
      profileIcon.setAttribute('aria-expanded', isActive);
    }
    profileIcon.addEventListener('click', toggleProfileDropdown);
    window.addEventListener('click', (e) => {
      if (!profileIcon.contains(e.target) && !profileDropdown.contains(e.target)) {
        profileDropdown.classList.remove('active');
        profileIcon.setAttribute('aria-expanded', false);
      }
    });

    async function loadUserInfo() {
      try {
        const response = await fetch('/profile', {
          credentials: 'include',
          headers: { 'Accept': 'application/json' }
        });

        if (!response.ok) throw new Error('Failed to fetch user info');

        const data = await response.json();
        profileInfoDiv.innerHTML = `
          <strong>${data.username || 'User'}</strong><br>
          Balance: $${(data.balance ?? 0).toFixed(2)}<br>
          Spent: $${(data.spent ?? 0).toFixed(2)}<br>
          Joined: ${data.joinDate || 'Unknown'}<br>
          Orders: ${data.orders ?? 0}
        `;
      } catch (err) {
        profileInfoDiv.textContent = 'Not logged in';
        if (err.message.includes('Failed')) window.location.href = '/login';
      }
    }

    loadUserInfo();
  </script>

</body>
</html>
