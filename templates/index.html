
<!DOCTYPE html>
<html>
<head>
  <title>Paradise Shop</title>
</head>
<body>
  <h2>Welcome to Paradise Shop</h2>
  <div id="profileInfo"></div>
  <div id="productList"></div>

  <script>
    const token = localStorage.getItem('token');

    if (!token) {
      window.location.href = '/login';
    }

    // Fetch profile
    fetch('/profile', {
      headers: {
        'Authorization': 'Bearer ' + token
      }
    })
    .then(res => {
      if (!res.ok) throw new Error('Unauthorized');
      return res.json();
    })
    .then(data => {
      document.getElementById('profileInfo').innerHTML = `
        <p><strong>User:</strong> ${data.username}</p>
        <p><strong>Balance:</strong> $${data.balance.toFixed(2)}</p>
        <button onclick="logout()">Logout</button>
      `;
    })
    .catch(() => {
      localStorage.removeItem('token');
      window.location.href = '/login';
    });

    // Fetch products
    fetch('/products')
    .then(res => res.json())
    .then(products => {
      const list = document.getElementById('productList');
      list.innerHTML = '<h3>Products</h3>';
      products.forEach(p => {
        const item = document.createElement('div');
        item.innerHTML = `
          <p><strong>${p.name}</strong> - $${p.price.toFixed(2)}</p>
          <button onclick="buy(${p.id})">Buy Now</button>
        `;
        list.appendChild(item);
      });
    });

    function buy(productId) {
      fetch('/checkout/' + productId, {
        method: 'POST',
        headers: {
          'Authorization': 'Bearer ' + token
        }
      })
      .then(res => res.json())
      .then(data => alert(data.message || 'Success'))
      .catch(err => alert('Error: ' + err.message));
    }

    function logout() {
      localStorage.removeItem('token');
      window.location.href = '/login';
    }
  </script>
</body>
</html>
