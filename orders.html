<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Your Orders - Paradise Shop</title>
  <style>
    body { 
      font-family: 'Segoe UI', sans-serif; 
      padding: 20px; 
      background: #f9f9f9;
      color: #333;
    }
    h1 {
      margin-bottom: 20px;
    }
    .order { 
      border: 1px solid #ccc; 
      margin-bottom: 15px; 
      padding: 10px; 
      background: #fff;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgb(0 0 0 / 0.1);
    }
    .order-header { 
      font-weight: bold; 
      margin-bottom: 10px; 
      color: #007acc;
    }
    .order-items { 
      margin-left: 15px; 
    }
    #profileInfo {
      font-weight: bold;
      margin-bottom: 20px;
      padding: 10px;
      background: #e1f5fe;
      border-radius: 6px;
      box-shadow: inset 0 0 5px #90caf9;
    }
  </style>
</head>
<body>

<h1>Your Orders</h1>

<!-- Profile Info -->
<div id="profileInfo">Loading profile...</div>

<!-- Orders List -->
<div id="orders-list">Loading orders...</div>

<script>
  const ordersList = document.getElementById('orders-list');
  const profileInfo = document.getElementById('profileInfo');

  async function loadOrders() {
    const token = localStorage.getItem('token');
    if (!token) {
      alert('Please log in to view your orders.');
      window.location.href = 'login.html';
      return;
    }

    try {
      const res = await fetch('/api/orders', {  // Adjust this endpoint if needed
        method: 'GET',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        }
      });

      if (res.status === 401) {
        alert('Session expired or unauthorized. Please login again.');
        localStorage.removeItem('token');
        window.location.href = 'login.html';
        return;
      }

      if (!res.ok) throw new Error('Fetch failed');

      const data = await res.json();

      // Show Profile Info
      profileInfo.innerHTML = `
        ${data.username} <br>
        Balance: $${data.balance.toFixed(2)} <br>
        Orders: ${data.orders.length} <br>
        Joined: ${data.joinDate || 'Unknown'}
      `;

      // Show Orders
      if (!data.orders || data.orders.length === 0) {
        ordersList.innerHTML = '<p>You have no orders yet.</p>';
        return;
      }

      ordersList.innerHTML = '';
      data.orders.forEach((order, i) => {
        const div = document.createElement('div');
        div.className = 'order';

        let itemsHtml = '<ul>';
        order.items.forEach(item => {
          itemsHtml += `<li>${item.name} - $${item.price.toFixed(2)}</li>`;
        });
        itemsHtml += '</ul>';

        div.innerHTML = `
          <div class="order-header">Order #${order.id || i + 1}</div>
          <div class="order-items">${itemsHtml}</div>
        `;

        ordersList.appendChild(div);
      });

    } catch (err) {
      console.error(err);
      ordersList.innerHTML = '<p>Error loading orders. Please try again later.</p>';
      profileInfo.textContent = 'Error loading profile.';
    }
  }

  loadOrders();
</script>

</body>
</html>
